---
title: Claude API Integration
description: "API reference for integrating Claude with Excel workbooks"
---

## Overview

The Excel-Claude API provides endpoints to interact with Excel workbooks using Claude's AI capabilities. This API combines Microsoft Graph API calls with Claude's intelligence to enable natural language interactions with spreadsheet data.

## Base URL

```
https://api.your-domain.com/v1
```

For local development:
```
http://localhost:3000/v1
```

## Authentication

All API requests require authentication using a Bearer token:

```bash
Authorization: Bearer YOUR_ACCESS_TOKEN
```

The access token is obtained through the OAuth flow described in the [OneDrive Setup](/excel-onedrive-setup) guide.

## Endpoints

### Query Workbook

Analyze Excel data using natural language queries.

<ParamField path="POST /workbooks/{workbookId}/query" type="endpoint">
  Submit a natural language query to analyze workbook data
</ParamField>

#### Request

<CodeGroup>
```bash cURL
curl -X POST https://api.your-domain.com/v1/workbooks/ABC123/query \
  -H "Authorization: Bearer YOUR_ACCESS_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "query": "What is the total revenue for Q4?",
    "worksheet": "Sales Data",
    "includeCharts": true
  }'
```

```javascript JavaScript
const response = await fetch(
  'https://api.your-domain.com/v1/workbooks/ABC123/query',
  {
    method: 'POST',
    headers: {
      'Authorization': `Bearer ${accessToken}`,
      'Content-Type': 'application/json',
    },
    body: JSON.stringify({
      query: 'What is the total revenue for Q4?',
      worksheet: 'Sales Data',
      includeCharts: true,
    }),
  }
);

const data = await response.json();
```

```python Python
import requests

response = requests.post(
    'https://api.your-domain.com/v1/workbooks/ABC123/query',
    headers={
        'Authorization': f'Bearer {access_token}',
        'Content-Type': 'application/json',
    },
    json={
        'query': 'What is the total revenue for Q4?',
        'worksheet': 'Sales Data',
        'includeCharts': True,
    }
)

data = response.json()
```
</CodeGroup>

#### Parameters

<ParamField path="workbookId" type="string" required>
  The OneDrive ID of the Excel workbook
</ParamField>

<ParamField body="query" type="string" required>
  Natural language query to analyze the data
</ParamField>

<ParamField body="worksheet" type="string">
  Specific worksheet name to query (if not provided, uses active sheet)
</ParamField>

<ParamField body="includeCharts" type="boolean" default="false">
  Whether to include chart suggestions in the response
</ParamField>

<ParamField body="context" type="object">
  Additional context for the query
  ```json
  {
    "dateRange": { "start": "2024-01-01", "end": "2024-12-31" },
    "filters": { "region": "North America" }
  }
  ```
</ParamField>

#### Response

<ResponseField name="answer" type="string">
  Natural language answer to the query
</ResponseField>

<ResponseField name="data" type="object">
  Structured data extracted from the workbook
</ResponseField>

<ResponseField name="formula" type="string">
  Excel formula generated (if applicable)
</ResponseField>

<ResponseField name="chart" type="object">
  Chart configuration (if requested)
</ResponseField>

<CodeGroup>
```json 200 Success
{
  "answer": "The total revenue for Q4 is $2,450,000, which represents a 15% increase from Q3.",
  "data": {
    "totalRevenue": 2450000,
    "quarters": [
      { "quarter": "Q1", "revenue": 1800000 },
      { "quarter": "Q2", "revenue": 2100000 },
      { "quarter": "Q3", "revenue": 2130000 },
      { "quarter": "Q4", "revenue": 2450000 }
    ]
  },
  "formula": "=SUMIF(A:A, \"Q4\", B:B)",
  "chart": {
    "type": "column",
    "title": "Quarterly Revenue",
    "xAxis": "quarters",
    "yAxis": "revenue"
  },
  "metadata": {
    "processingTime": 1234,
    "tokensUsed": 450
  }
}
```

```json 400 Bad Request
{
  "error": {
    "code": "INVALID_QUERY",
    "message": "Query cannot be empty",
    "details": "Please provide a valid natural language query"
  }
}
```

```json 404 Not Found
{
  "error": {
    "code": "WORKBOOK_NOT_FOUND",
    "message": "The specified workbook does not exist",
    "details": "Workbook ID: ABC123"
  }
}
```
</CodeGroup>

---

### Generate Formula

Generate Excel formulas from natural language descriptions.

<ParamField path="POST /workbooks/{workbookId}/formula" type="endpoint">
  Generate an Excel formula based on description
</ParamField>

#### Request

<CodeGroup>
```bash cURL
curl -X POST https://api.your-domain.com/v1/workbooks/ABC123/formula \
  -H "Authorization: Bearer YOUR_ACCESS_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "description": "Calculate the average of column B where column A is greater than 100",
    "cell": "D2"
  }'
```

```javascript JavaScript
const response = await fetch(
  'https://api.your-domain.com/v1/workbooks/ABC123/formula',
  {
    method: 'POST',
    headers: {
      'Authorization': `Bearer ${accessToken}`,
      'Content-Type': 'application/json',
    },
    body: JSON.stringify({
      description: 'Calculate the average of column B where column A is greater than 100',
      cell: 'D2',
    }),
  }
);
```
</CodeGroup>

#### Parameters

<ParamField body="description" type="string" required>
  Natural language description of the desired calculation
</ParamField>

<ParamField body="cell" type="string">
  Target cell for the formula (e.g., "D2")
</ParamField>

<ParamField body="applyFormula" type="boolean" default="false">
  Whether to automatically apply the formula to the workbook
</ParamField>

#### Response

<CodeGroup>
```json 200 Success
{
  "formula": "=AVERAGEIF(A:A, \">100\", B:B)",
  "explanation": "This formula calculates the average of values in column B where the corresponding value in column A is greater than 100.",
  "applied": false,
  "cell": "D2",
  "result": 156.75
}
```
</CodeGroup>

---

### Transform Data

Transform and clean data using Claude's intelligence.

<ParamField path="POST /workbooks/{workbookId}/transform" type="endpoint">
  Transform data in specified range
</ParamField>

#### Request

<CodeGroup>
```bash cURL
curl -X POST https://api.your-domain.com/v1/workbooks/ABC123/transform \
  -H "Authorization: Bearer YOUR_ACCESS_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "range": "A1:C100",
    "transformation": "Remove duplicates and standardize date format to YYYY-MM-DD",
    "preview": true
  }'
```

```javascript JavaScript
const response = await fetch(
  'https://api.your-domain.com/v1/workbooks/ABC123/transform',
  {
    method: 'POST',
    headers: {
      'Authorization': `Bearer ${accessToken}`,
      'Content-Type': 'application/json',
    },
    body: JSON.stringify({
      range: 'A1:C100',
      transformation: 'Remove duplicates and standardize date format to YYYY-MM-DD',
      preview: true,
    }),
  }
);
```
</CodeGroup>

#### Parameters

<ParamField body="range" type="string" required>
  Cell range to transform (e.g., "A1:C100")
</ParamField>

<ParamField body="transformation" type="string" required>
  Description of the transformation to perform
</ParamField>

<ParamField body="preview" type="boolean" default="true">
  Return preview without applying changes
</ParamField>

#### Response

<CodeGroup>
```json 200 Success
{
  "preview": [
    ["Date", "Amount", "Status"],
    ["2024-01-15", "1000", "Complete"],
    ["2024-01-16", "1500", "Complete"]
  ],
  "changes": {
    "duplicatesRemoved": 5,
    "cellsModified": 23,
    "errors": []
  },
  "applied": false
}
```
</CodeGroup>

---

### List Workbooks

Retrieve all Excel workbooks from OneDrive.

<ParamField path="GET /workbooks" type="endpoint">
  List all accessible Excel workbooks
</ParamField>

#### Request

<CodeGroup>
```bash cURL
curl -X GET "https://api.your-domain.com/v1/workbooks?limit=20&offset=0" \
  -H "Authorization: Bearer YOUR_ACCESS_TOKEN"
```

```javascript JavaScript
const response = await fetch(
  'https://api.your-domain.com/v1/workbooks?limit=20&offset=0',
  {
    headers: {
      'Authorization': `Bearer ${accessToken}`,
    },
  }
);
```
</CodeGroup>

#### Parameters

<ParamField query="limit" type="integer" default="20">
  Number of workbooks to return (max 100)
</ParamField>

<ParamField query="offset" type="integer" default="0">
  Pagination offset
</ParamField>

<ParamField query="search" type="string">
  Search query to filter workbooks by name
</ParamField>

#### Response

<CodeGroup>
```json 200 Success
{
  "workbooks": [
    {
      "id": "ABC123",
      "name": "Sales Report 2024.xlsx",
      "url": "https://onedrive.live.com/...",
      "lastModified": "2024-12-01T10:30:00Z",
      "size": 524288,
      "worksheets": ["Sales Data", "Summary", "Charts"]
    },
    {
      "id": "DEF456",
      "name": "Budget Analysis.xlsx",
      "url": "https://onedrive.live.com/...",
      "lastModified": "2024-11-28T15:45:00Z",
      "size": 1048576,
      "worksheets": ["Q1", "Q2", "Q3", "Q4"]
    }
  ],
  "pagination": {
    "total": 45,
    "limit": 20,
    "offset": 0,
    "hasMore": true
  }
}
```
</CodeGroup>

---

### Get Workbook Details

Get detailed information about a specific workbook.

<ParamField path="GET /workbooks/{workbookId}" type="endpoint">
  Retrieve workbook metadata and structure
</ParamField>

#### Request

<CodeGroup>
```bash cURL
curl -X GET https://api.your-domain.com/v1/workbooks/ABC123 \
  -H "Authorization: Bearer YOUR_ACCESS_TOKEN"
```

```javascript JavaScript
const response = await fetch(
  'https://api.your-domain.com/v1/workbooks/ABC123',
  {
    headers: {
      'Authorization': `Bearer ${accessToken}`,
    },
  }
);
```
</CodeGroup>

#### Response

<CodeGroup>
```json 200 Success
{
  "id": "ABC123",
  "name": "Sales Report 2024.xlsx",
  "url": "https://onedrive.live.com/...",
  "lastModified": "2024-12-01T10:30:00Z",
  "size": 524288,
  "worksheets": [
    {
      "name": "Sales Data",
      "position": 0,
      "visibility": "visible",
      "rows": 1000,
      "columns": 15
    },
    {
      "name": "Summary",
      "position": 1,
      "visibility": "visible",
      "rows": 50,
      "columns": 8
    }
  ],
  "namedRanges": [
    {
      "name": "TotalRevenue",
      "range": "Summary!B2"
    }
  ],
  "charts": [
    {
      "name": "RevenueChart",
      "type": "column",
      "worksheet": "Summary"
    }
  ]
}
```
</CodeGroup>

---

## Using Claude API Directly

For advanced use cases, you can call Claude API directly with Excel data.

### Preparing Data for Claude

<CodeGroup>
```javascript Fetch and Format Data
// 1. Get data from Excel via Microsoft Graph
const graphResponse = await fetch(
  `https://graph.microsoft.com/v1.0/me/drive/items/${workbookId}/workbook/worksheets/Sheet1/usedRange`,
  {
    headers: {
      'Authorization': `Bearer ${graphAccessToken}`,
    },
  }
);

const excelData = await graphResponse.json();

// 2. Format for Claude
const formattedData = {
  headers: excelData.values[0],
  rows: excelData.values.slice(1),
};

// 3. Send to Claude
const claudeResponse = await fetch('https://api.anthropic.com/v1/messages', {
  method: 'POST',
  headers: {
    'x-api-key': process.env.CLAUDE_API_KEY,
    'anthropic-version': '2023-06-01',
    'content-type': 'application/json',
  },
  body: JSON.stringify({
    model: 'claude-3-5-sonnet-20241022',
    max_tokens: 1024,
    messages: [
      {
        role: 'user',
        content: `Analyze this Excel data and provide insights:\n\n${JSON.stringify(formattedData, null, 2)}\n\nQuestion: What are the top 5 products by revenue?`,
      },
    ],
  }),
});

const analysis = await claudeResponse.json();
```

```python Python with Anthropic SDK
import anthropic
from msgraph import GraphServiceClient

# 1. Get data from Excel
graph_client = GraphServiceClient(credentials, scopes)
workbook_range = await graph_client.me.drive.items[workbook_id].workbook.worksheets['Sheet1'].used_range().get()

# 2. Format for Claude
data_text = f"Headers: {workbook_range.values[0]}\n"
for row in workbook_range.values[1:]:
    data_text += f"Row: {row}\n"

# 3. Send to Claude
client = anthropic.Anthropic(api_key=os.environ.get("CLAUDE_API_KEY"))

message = client.messages.create(
    model="claude-3-5-sonnet-20241022",
    max_tokens=1024,
    messages=[
        {
            "role": "user",
            "content": f"Analyze this Excel data and provide insights:\n\n{data_text}\n\nQuestion: What are the top 5 products by revenue?"
        }
    ]
)

print(message.content)
```
</CodeGroup>

### Streaming Responses

For large datasets, use Claude's streaming API:

<CodeGroup>
```javascript Streaming with Claude
const response = await fetch('https://api.anthropic.com/v1/messages', {
  method: 'POST',
  headers: {
    'x-api-key': process.env.CLAUDE_API_KEY,
    'anthropic-version': '2023-06-01',
    'content-type': 'application/json',
  },
  body: JSON.stringify({
    model: 'claude-3-5-sonnet-20241022',
    max_tokens: 4096,
    stream: true,
    messages: [
      {
        role: 'user',
        content: `Analyze this large dataset: ${excelData}`,
      },
    ],
  }),
});

const reader = response.body.getReader();
const decoder = new TextDecoder();

while (true) {
  const { done, value } = await reader.read();
  if (done) break;

  const chunk = decoder.decode(value);
  const lines = chunk.split('\n').filter((line) => line.trim());

  for (const line of lines) {
    if (line.startsWith('data: ')) {
      const data = JSON.parse(line.slice(6));
      if (data.type === 'content_block_delta') {
        process.stdout.write(data.delta.text);
      }
    }
  }
}
```
</CodeGroup>

## Rate Limits

<Warning>
  Be mindful of rate limits for both Microsoft Graph and Claude APIs
</Warning>

### Microsoft Graph API
- **Free tier**: 2,000 requests/hour per user
- **Business tier**: 10,000 requests/hour per user

### Claude API
- Varies by pricing tier
- Check your limits at [console.anthropic.com](https://console.anthropic.com)

### Rate Limit Headers

```http
X-RateLimit-Limit: 1000
X-RateLimit-Remaining: 999
X-RateLimit-Reset: 1701234567
Retry-After: 60
```

## Error Handling

<AccordionGroup>
  <Accordion title="400 Bad Request" icon="circle-exclamation">
    Invalid request parameters

    ```json
    {
      "error": {
        "code": "INVALID_REQUEST",
        "message": "Validation failed",
        "details": [
          {
            "field": "query",
            "message": "Query cannot be empty"
          }
        ]
      }
    }
    ```
  </Accordion>

  <Accordion title="401 Unauthorized" icon="circle-exclamation">
    Missing or invalid authentication token

    ```json
    {
      "error": {
        "code": "UNAUTHORIZED",
        "message": "Invalid or expired access token"
      }
    }
    ```
  </Accordion>

  <Accordion title="403 Forbidden" icon="circle-exclamation">
    Insufficient permissions

    ```json
    {
      "error": {
        "code": "FORBIDDEN",
        "message": "Insufficient permissions to access this workbook"
      }
    }
    ```
  </Accordion>

  <Accordion title="429 Too Many Requests" icon="circle-exclamation">
    Rate limit exceeded

    ```json
    {
      "error": {
        "code": "RATE_LIMIT_EXCEEDED",
        "message": "Too many requests",
        "retryAfter": 60
      }
    }
    ```
  </Accordion>

  <Accordion title="500 Internal Server Error" icon="circle-exclamation">
    Server error

    ```json
    {
      "error": {
        "code": "INTERNAL_ERROR",
        "message": "An unexpected error occurred",
        "requestId": "req_abc123"
      }
    }
    ```
  </Accordion>
</AccordionGroup>

## Webhooks

Subscribe to workbook changes for real-time updates.

<ParamField path="POST /workbooks/{workbookId}/webhooks" type="endpoint">
  Create a webhook subscription
</ParamField>

<CodeGroup>
```bash Create Webhook
curl -X POST https://api.your-domain.com/v1/workbooks/ABC123/webhooks \
  -H "Authorization: Bearer YOUR_ACCESS_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "url": "https://your-app.com/webhook",
    "events": ["data.changed", "formula.added"],
    "secret": "your-webhook-secret"
  }'
```

```json Webhook Payload
{
  "event": "data.changed",
  "workbookId": "ABC123",
  "worksheet": "Sales Data",
  "range": "A1:C10",
  "timestamp": "2024-12-05T10:30:00Z",
  "user": {
    "id": "user123",
    "email": "user@example.com"
  }
}
```
</CodeGroup>

## SDK Examples

### JavaScript/TypeScript

```bash
npm install @your-org/excel-claude-sdk
```

```typescript
import { ExcelClaudeClient } from '@your-org/excel-claude-sdk';

const client = new ExcelClaudeClient({
  accessToken: 'YOUR_ACCESS_TOKEN',
});

// Query workbook
const result = await client.query({
  workbookId: 'ABC123',
  query: 'What is the total revenue?',
});

console.log(result.answer);
```

### Python

```bash
pip install excel-claude-sdk
```

```python
from excel_claude import ExcelClaudeClient

client = ExcelClaudeClient(access_token='YOUR_ACCESS_TOKEN')

# Query workbook
result = client.query(
    workbook_id='ABC123',
    query='What is the total revenue?'
)

print(result['answer'])
```

## Next Steps

<CardGroup cols={2}>
  <Card title="View Examples" icon="lightbulb" href="/excel-examples">
    Explore practical code examples
  </Card>

  <Card title="API Reference" icon="book" href="/api-reference/introduction">
    Complete API documentation
  </Card>
</CardGroup>
